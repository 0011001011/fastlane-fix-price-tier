# Advanced fastlane

### Environment Variables
You can define environment variables in a `.env` or `.env.default` file in the same directory as your `Fastfile`. Environment variables are loading used [dotenv](https://github.com/bkeepers/dotenv)

#### Example using `dotenv`
**Filename:** .env
```
WORKSPACE=YourApp.xcworkspace
HOCKEYAPP_API_TOKEN=your-hockey-api-token
```

#### Environment specific `dotenv` variables
`fastlane` also has a `--env` option that allows loading of environment specific `dotenv` files. `.env` and `.env.default` will be loaded before environment specific `dotenv` files are loaded. The naming convention for environment specific `dotenv` files is `.env.<environment>`

**Example:** `fastlane <lane-name> --env development` will load `.env`, `.env.default`, and `.env.development`


#### Lane Context
The different actions can *communicate* with each other using a shared hash.
Access them in your scrips using:
```ruby
Actions.lane_context[Actions::SharedValues::LANE_NAME] # the name of the current lane
```
Available variables (put that inside the square brackets of the above snippet)
```ruby
Actions::SharedValues::BUILD_NUMBER # generated by `increment_build_number`
Actions::SharedValues::SNAPSHOT_SCREENSHOTS_PATH # generated by `snapshot`
Actions::SharedValues::PRODUCE_APPLE_ID # the Apple ID of the newly created app
Actions::SharedValues::IPA_OUTPUT_PATH # generated by `ipa`
Actions::SharedValues::SIGH_PROFILE_PATH # generated by `sigh`
Actions::SharedValues::SIGH_UDID # the UDID of the generated provisioning profile
Actions::SharedValues::HOCKEY_DOWNLOAD_LINK #generated by `hockey`
Actions::SharedValues::DEPLOYGATE_URL # generated by `deploygate`
Actions::SharedValues::DEPLOYGATE_APP_REVISION # integer, generated by `deploygate`
Actions::SharedValues::DEPLOYGATE_APP_INFO # Hash, generated by `deploygate`
````

#### Run multiple ```lanes```
You can run multiple ```lanes``` (in the given order) using
```
fastlane test inhouse appstore
````
Keep in mind the ```before_all``` and ```after_all``` block will be executed for each of the ```lanes```.

#### Hide the `fastlane` folder
Just rename the folder to `.fastlane` in case you don't want it to be visible in the Finder.

#### Load own actions from external folder
Add this to the top of your `Fastfile` (*.* is the `fastlane` folder)
```ruby
actions_path '../custom_actions_folder/'
```

### The `Appfile`

Once initialized, the Fastlane platform will take care to create some useful resources for you like the `Appfile`.

The `Appfile` stores useful information that are used across all Fastlane tools like your *Apple ID* or the application *Bundle Identifier*, to deploy your lanes faster and tailored on your project and needs. 

#### Configure the `Appfile`

By default an Appfile looks like:

```ruby
app_identifier "net.sunapps.1" # The bundle identifier of your app
apple_id "felix@sunapps.net" # Your Apple email address

# You can uncomment the lines below and add your own 
# team selection in case you're in multiple teams
# team_name "Felix Krause"
# team_id "Q2CBPJ58CA"
```

If your project has different bundle identifiers per environment (i.e. beta, app store), you can define that by using `for_lane` block declaration.

The configuration described for a lane will be loaded __together__ with values defined outside the block. If no block is found for current driven lane, the value inside the blocks will be used, otherwise the value outside.

### Example using `for_lane`

```ruby
app_identifier "net.sunapps.1"
apple_id "felix@sunapps.net"
team_id "Q2CBPJ58CC"

for_lane :beta do
  app_identifier "net.sunapps.1.beta"
end

for_lane :enterprise do
  app_identifier "enterprise.com"
end
```
